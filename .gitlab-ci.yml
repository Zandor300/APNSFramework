image: composer:latest

stages:
  - lint
  - docs

cache:
  paths:
    - vendor/

before_script:
  - composer install

composer-validate:
  stage: lint
  script:
    - composer validate
  tags:
    - docker

php-lint:
  stage: lint
  script:
    - cd apnsframework
    - if find . -name "*.php" ! -path "./vendor/*" -exec php -l {} \; | grep -v "No syntax errors detected"; then exit 1; fi
  tags:
    - docker

php-lint-examples:
  stage: lint
  script:
    - cd example
    - if find . -name "*.php" ! -path "./vendor/*" -exec php -l {} \; | grep -v "No syntax errors detected"; then exit 1; fi
  tags:
    - docker
  allow_failure: true

phpdox:
  stage: docs
  script:
    - apt install libxslt-dev
    - docker-php-ext-install xsl
    - docker-php-ext-enable xsl
    - wget http://phpdox.de/releases/phpdox.phar
    - php phpdox.phar
  tags:
    - docker
  artifacts:
    paths:
      - build/api/html
